# Fail2Ban filter for Home Assistant authentication failures
# Matches failed login attempts from Home Assistant's internal log
#
# Home Assistant returns HTTP 200 even for failed logins, so we cannot
# use nginx access logs to detect authentication failures. Instead, we
# monitor HA's own log file which clearly logs failed attempts.
#
# Log format examples:
# Internal IP: from 192.168.178.151 (192.168.178.151)
# External IP: from tmo-075-4.customers.d1-online.com (80.187.75.4)
#
# Note: HA shows hostname first (if reverse DNS available), IP always in parentheses

[Definition]

# Match failed authentication attempts logged by Home Assistant
# Capture IP from parentheses (always present), skip optional hostname before it
failregex = ^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d+ WARNING \(MainThread\) \[homeassistant\.components\.http\.ban\] Login attempt or request with invalid authentication from \S+ \(<HOST>\)

# No ignore patterns needed - all matches are genuine failures
ignoreregex =
