# Fail2Ban filter for Nginx authentication failures
# Matches 401 Unauthorized responses on authentication endpoints
#
# Covers:
# - Immich: /api/auth, /api/user
# - Paperless: /api/auth, /api/token
# - FreshRSS: /login, /api/greader

[Definition]

# Match 401 Unauthorized on authentication endpoints
# Format: IP - - [timestamp] "METHOD /path HTTP/version" 401 size "referer" "user-agent"
failregex = ^<HOST> - .* - \[[^\]]+\] "(GET|POST|PUT|DELETE|PATCH) /(api/(auth|token|user|greader)|login|admin/login)[^\s]* HTTP/[0-9.]+" 401 \d+

# Ignore successful requests (200-299, 300-399)
ignoreregex = ^<HOST> .* HTTP/[0-9.]+" [23]\d\d
